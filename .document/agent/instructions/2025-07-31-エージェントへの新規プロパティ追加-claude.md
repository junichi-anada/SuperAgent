### **📄 指示書（最終版）: エージェントへの新規プロパティ追加**

#### **1. 目的**
エージェントに新しいプロフィール項目（名前、性別、性格、役割、口調、背景設定）を追加し、UIから登録・編集できるようにする。

#### **2. 指示方針**
*   **技術スタック**: バックエンドはFastAPI、フロントはNext.js、DBマイグレーションはAlembic。
*   **参考資料**: 既存コードのスタイルに合わせること。
*   **アウトプット**: 変更したファイルはパスを明記し、コード全体を出力。最後に変更ファイル一覧を報告。
*   **禁止事項**: 関係ないファイルの変更はNG。既存マイグレーションの編集もNG（必ず新規作成）。
*   **進捗報告**: DB、バックエンド、フロントエンドの各フェーズ完了ごとに報告。

#### **3. 詳細仕様**
*   **追加項目**: `name`, `gender`, `personality`, `role`, `tone`, `background`。
*   **UI要件**: `gender`はドロップダウン、`personality`・`role`・`tone`は複数選択可能なチェックボックス（タグ型）。
*   **DB設計**: `agents`テーブルに`gender`カラムを追加。`personalities`, `roles`, `tones`の3つのタグ管理テーブルと、それらを紐付ける3つの中間テーブルを新規作成（多対多リレーション）。
*   **ダミーデータ**: UIで表示するためのダミーの選択肢（性別、性格など）をDBに初期登録すること。

#### **4. 作業手順**
1.  **DBフェーズ**:
    *   `backend/models.py`を更新し、新しいテーブルとリレーションを定義する。
    *   Alembicでマイグレーションファイルを生成し、ダミーデータ投入処理を追加後、DBに適用する。
2.  **バックエンドフェーズ**:
    *   `schemas.py`と`crud.py`を新しいDB構造に合わせて更新する。
    *   フロントエンドにタグの選択肢を渡すための新しいAPIエンドポイント (`/tags/personalities`など) を作成する。
3.  **フロントエンドフェーズ**:
    *   エージェント作成・編集ページで、新しいAPIからタグ一覧を取得してチェックボックスを描画する。
    *   フォーム送信時に、選択されたタグのIDリストをAPIに送るようにロジックを更新する。
    *   詳細ページで全ての新項目が表示されるようにする。

#### **5. 検証方法**
*   UIからエージェントの作成・編集が一通り問題なくできるか。
*   DBの各テーブルにデータが意図通り保存されているか。
